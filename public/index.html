<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>deerdesk</title>
	<style type="text/css">
		@import url('https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,700;1,700&display=swap');
	
		:root {
			--bg: #384636;
			--color: #f1e5d2;
			--light: cyan;
			--light-bg: rgba(0, 255, 255, 0.25);
		}
		
		#canvases {
			width: 100vw;
			height: 100vh;
		}
		
		* {
			-webkit-touch-callout: none; /* iOS Safari */
	    -webkit-user-select: none; /* Safari */
	     -khtml-user-select: none; /* Konqueror HTML */
	       -moz-user-select: none; /* Old versions of Firefox */
	        -ms-user-select: none; /* Internet Explorer/Edge */
	            user-select: none; /* Non-prefixed version, currently
	                                  supported by Chrome, Edge, Opera and Firefox */
			outline: none;
		}

		html {
			overflow: hidden;
			background: var(--bg);
			color: var(--white);
		}

		body {
			position: fixed;
		  top: 0;
		  left: 50%;
		  bottom: 0;
			margin: 0;
		}
		
		canvas {
			image-rendering: -moz-crisp-edges;
		  image-rendering: -webkit-crisp-edges;
		  image-rendering: pixelated;
		  image-rendering: crisp-edges;
			touch-action: none;
		}

		.centered {
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
			color: var(--color);
			text-align: center;
			font-size: 20px;
			min-width: 20em;
			font-family: 'Josefin Sans', monospace;
		}

		#bg {
			background: var(--bg);
			width: 500px;
			height: 500px;
			animation: blobber 30s ease-in-out infinite, cobler 30s linear infinite alternate;
			z-index: -10;
		}

		@keyframes cobler {
			0% {
		        background-position: 0% 0%;
		    }
		    100% {
		        background-position: 100% 0%;
		    }
		}

		@keyframes blobber {
		    0%  { border-radius: 48% 52% 68% 32% / 42% 28% 72% 58%; }
		    5%  { border-radius: 48% 52% 41% 59% / 66% 37% 63% 34%; }
		    10% { border-radius: 69% 31% 71% 29% / 67% 31% 69% 33%; }
		    15% { border-radius: 60% 40% 71% 29% / 63% 65% 35% 37%; }
		    20% { border-radius: 61% 39% 51% 49% / 57% 58% 42% 43%; }
		    25% { border-radius: 66% 34% 25% 75% / 47% 30% 70% 53%; }
		    30% { border-radius: 32% 68% 38% 62% / 65% 60% 40% 35%; }
		    35% { border-radius: 63% 37% 41% 59% / 35% 38% 62% 65%; }
		    40% { border-radius: 57% 43% 49% 51% / 55% 71% 29% 45%; }
		    45% { border-radius: 47% 53% 34% 66% / 65% 36% 64% 35%; }
		    50% { border-radius: 44% 56% 32% 68% / 69% 26% 74% 31%; }
		    55% { border-radius: 28% 72% 37% 63% / 71% 44% 56% 29%; }    
		    60% { border-radius: 38% 62% 35% 65% / 74% 53% 47% 26%; }
		    65% { border-radius: 73% 27% 46% 54% / 54% 47% 53% 46%; }
		    70% { border-radius: 75% 25% 47% 53% / 49% 53% 47% 51%; }
		    75% { border-radius: 62% 38% 43% 57% / 55% 60% 40% 45%; }
		    80% { border-radius: 41% 59% 65% 35% / 73% 50% 50% 27%; }
		    85% { border-radius: 55% 45% 57% 43% / 73% 61% 39% 27%; }
		    90% { border-radius: 74% 26% 33% 67% / 40% 65% 35% 60%; }
		    95% { border-radius: 58% 42% 57% 43% / 53% 45% 55% 47%; }
		    100%{ border-radius: 48% 52% 68% 32% / 42% 28% 72% 58%; }
		}
		
		#gameintro {
			z-index: 1;
			text-align: center;
			pointer-events: none;
		}
		#gameintro span {
			display: inline-block;
		}
		#gameintro canvas {
			display: inline-block !important;
			background: var(--light-bg);
			margin: 1em;
			border-radius: 50%;
		}
		
		button {
			padding: 0.5em;
			font-family: inherit;
			font-size: inherit;
			color: inherit;
			background: transparent;
			border: inherit;
			display: inline-block;
			cursor: pointer;
			background: var(--light-bg);
			width: 10em;
			border-radius: 1em;
			color: var(--light);
			transition: all 300ms ease-out;
			margin-left: 0.5em;
			margin-right: 0.5em;
			margin-bottom: 0.5em;
			pointer-events: auto;
		}
		button:active {
			background: var(--bg);
		}
		
		hr {
			border-color: var(--light-bg);
		}
		
		#phone_ui {
			margin-top: 10em;
			z-index: 11;
			width: 100vw;
		}
		#phone_ui button {
			/* background: transparent; */
			/* border-top: 1px solid var(--light); */
			/* border-bottom: 1px solid var(--light); */
			/* border-radius: 0; */
			color: var(--color);
		}
		
		.hidden {
			display: none !important;
		}
		
		#drawing_menu {
			color: white;
			opacity: 0.6;
		}
		
		.clock {
			background: var(--bg);
			border-radius: 1em;
			padding: 1em;
			opacity: 0.75;
			margin-top: -5em;
		}
		
		.clock div {
			margin-bottom: 1em;
			width: fit-content;
		}
		
		.clock div button:last-child {
			/* border: 0.25em solid var(--light-bg); */
			margin-top: 1em;
			/* font-size: 0.9em;
			background: transparent; */
		}
	</style>
</head>
<body>

	<!-- <div id="bg" class="centered"></div> -->
	<span id="loading" class="centered">
		평소처럼 책상에 앉았다
		<br><br>
		<i>loading...</i>
	</span>
	<div id="canvases" class="centered">
		
	</div>
	<div id="gameintro" class="centered hidden">
		<span></span>
		<br>
		<div style="font-family:monospace;margin-top:0.5em">◍ ◌ ◌ ◌ ◌</div>
		<canvas></canvas>
		<br>
		<button>시작하기</button>
		<button id="message_made" class="hidden">쪽지 그리고 시작하기</button>
		<button id="return" class="hidden">게임 재생</button>
	</div>
	
	<div id="gameui">
		<div id="drawing_menu" class="centered hidden" style="pointer-events: none;">
			남들을 위한 쪽지를 그려<br>
			그걸 미끼로 삼았다
		</div>
	</div>

</body>

<script src="lib/three.js" type="text/javascript"></script>
<script src="lib/cannon.js" type="text/javascript"></script>
<script src="lib/howler.js" type="text/javascript"></script>
<script type="module" src="lib/main.js" type="text/javascript"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
	var player = {
		wins: {
			phone: 0,
			clock: 0,
			pc: 0,
		},
		username: "",
		messages: [],
	};
	
	var imgs = [];
	
	// https://stackoverflow.com/questions/19426882/node-js-socket-io-socket-io-js-not-found/22218615
	
	var socket = io.connect();
	// var socket = io('ws://deerdesk.azurewebsites.net', { transports: ['websocket'] });
	// var socket = io('ws://localhost:3000', { transports: ['websocket'] });
	
	function sendData() {
		socket.emit('datarequest');
	}
	
	socket.on('datasend', function(data) {
		console.log(data);
	});
	
	socket.on('connect', function() {
	  console.log('CONNECTED TO SERVER.');
	});
	
	socket.on('img', (data) => {
		imgs = data.array;
		
		// let todel = [];
		// for (let i=0; i<imgs.length; i++) {
		// 	for (let img of player.messages) {
		// 		if (imgs[i] == img) {
		// 			todel.push(i);
		// 			break;
		// 		}
		// 	}
		// }
		// 
		// for (let i=todel.length-1; i>=0; i--) {
		// 	imgs.splice(i, 1);
		// }
		
		var r = [];
		for (let img of imgs) {
			var i = document.createElement("img");
			i.src = img;
			r.push(i);
		}
		imgs = r;
		
		console.log(imgs);
	});
	
	socket.on('disconnect', function() {
		console.log('DISCONNECTED FROM SERVER.');
	});
</script>
</html>